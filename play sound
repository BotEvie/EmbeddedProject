//Nathan Matthews
//
//Play sound to speaker using DAC.
//

#include <stdio.h>
#include <stdlib.h>
#include "stm32l0xx.h"                  // Device header



void init_DAC(void);


void init_DAC(){
	
	RCC->APB1ENR |= RCC_APB1ENR_DACEN;   				//Supply clock to DAC
	
	DAC->CR &= ~DAC_CR_WAVE1_Msk;
	DAC->CR |= 2 << DAC_CR_WAVE1_Pos;           //Generate trinagle sound wave
	
	DAC->CR &= ~DAC_CR_MAMP1_Msk;
	DAC->CR |= 4 << DAC_CR_MAMP1_Pos;           //Triangle has amplitude of 31
	
	DAC->CR &= ~DAC_CR_TEN1_Msk;
	DAC->CR |= 1 << DAC_CR_TEN1_Pos;            //Trigger enable to allow a triangle wave 
	
	DAC->CR &= ~DAC_CR_TSEL1_Msk;
	DAC->CR |= 6 << DAC_CR_TSEL1_Pos;						//Trigger on an external pin...when the ADC pins go high 
	
	DAC->CR &= ~DAC_CR_EN1_Msk;										
	DAC->CR |= 1 << DAC_CR_EN1_Pos;	            //Enable DAC on channel 1
	
}
